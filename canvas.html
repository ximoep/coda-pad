<script>
  const canvas = document.getElementById("signature-pad");
  const signaturePad = new SignaturePad(canvas);

  // Obtener par√°metros de la URL
  const params = new URLSearchParams(window.location.search);
  const webhookUrl = "https://<tu-n8n-url>/webhook/save-signature"; // Cambia esto por tu URL de n8n
  const rowId = params.get("rowId");

  document.getElementById("clear").addEventListener("click", () => {
    signaturePad.clear();
  });

  document.getElementById("save").addEventListener("click", async () => {
    if (signaturePad.isEmpty()) {
      alert("Please draw your signature first.");
      return;
    }

    const dataUrl = signaturePad.toDataURL();

    // Enviar la firma al webhook
    try {
      const response = await fetch(webhookUrl, {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify({
          rowId: rowId,
          signatureData: dataUrl,
        }),
      });

      if (response.ok) {
        alert("Signature saved successfully!");
      } else {
        alert("Failed to save signature.");
      }
    } catch (error) {
      alert("Error sending signature: " + error.message);
    }
  });
</script>
